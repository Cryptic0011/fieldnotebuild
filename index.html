<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspection Note Builder - Advanced</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --primary-dark: #357ABD;
            --secondary-color: #50e3c2;
            --background-color: #f7f9fc;
            --card-background: #ffffff;
            --text-color: #4a4a4a;
            --light-text-color: #9b9b9b;
            --border-color: #e6e6e6;
            --danger-color: #e74c3c;
            --danger-dark: #c0392b;
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 2rem;
            padding-left: 80px; /* Space for the buttons */
        }

        #root {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2.5rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h2, h4 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-top: 0;
            display: flex;
            align-items: center;
        }
        
        h2 {
             border-bottom: 2px solid var(--border-color);
             padding-bottom: 0.75rem;
        }
        
        h4 {
            color: var(--primary-color);
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--light-text-color);
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 0.8rem 1rem;
            margin-bottom: 1.25rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-sizing: border-box;
            transition: all 0.3s ease;
            background-color: #fdfdfd;
            font-family: var(--font-family);
            font-size: 1rem;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        button {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-right: 0.5rem;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .remove-btn {
            background-color: var(--danger-color);
            color: white;
            margin-left: auto;
        }
        
        .remove-btn:hover {
            background-color: var(--danger-dark);
        }
        
        .participant-row {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .participant-row input {
            flex-grow: 1;
            margin-bottom: 0;
            margin-right: 1rem;
        }

        .section-card, .custom-section-card {
            background: var(--card-background);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.07);
        }

        .section-wrapper {
            position: relative;
            margin-bottom: 2rem; /* This creates the space for the button */
        }
        
        .add-between-btn {
            position: absolute;
            left: -60px;
            top: 100%;
            transform: translateY(-50%);
            z-index: 10;
            background: var(--card-background);
            color: var(--primary-color);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 300;
            line-height: 1;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0;
        }
        .add-between-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }
        
        .add-between-btn.minus {
             background-color: var(--danger-color);
             border-color: var(--danger-color);
             color: white;
             font-weight: 400;
        }
        
         .add-between-btn.minus:hover {
             background-color: var(--danger-dark);
             border-color: var(--danger-dark);
        }

        .custom-section-card {
             margin-top: 2rem;
             animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        pre {
            background-color: #fdfdfd;
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            border-radius: 8px;
            white-space: pre-wrap;
            word-wrap: break-word;
            position: relative;
            min-height: 150px;
            line-height: 1.6;
        }

        .copy-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #27ae60;
        }

        .copy-btn:hover {
            background: #229954;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [participants, setParticipants] = useState([{ id: Date.now(), name: 'Insured' }]);
            const [customSections, setCustomSections] = useState([]);
            
            const initialFields = {
                colDetails: '', showCol: false,
                perimeterGeneral: 'No such indicators were observed.', perimeterFront: 'No wind or hail damage observed.', perimeterLeft: 'No wind or hail damage observed.', perimeterRear: 'No wind or hail damage observed.', perimeterRight: 'No wind or hail damage observed.', perimeterEstimate: 'None prepared for no damage', showPerimeter: false,
                roofGeneral: '', roofFrontHits: '0', roofFrontWind: '0', roofRightHits: '0', roofRightWind: '0', roofRearHits: '0', roofRearWind: '0', roofLeftHits: '0', roofLeftWind: '0', roofEstimate: 'No estimate prepared', adjusterName: 'I', showRoof: false,
                otherStructuresDetails: '', showOtherStructures: false,
                rooms: [], interiorEstimate: 'No estimate prepared for interior damages.',
                subroDetails: 'No subro potential', showSubro: true,
                salvageDetails: 'No salvage potential', showSalvage: true,
                underwritingConcernsDetails: 'No underwriting concerns were noted during my inspection', showUnderwriting: true,
                settledOnSite: 'No', settlementDetails: 'Estimate prepared on site, went over estimate, RD, supplement process. Advised of 2 years to complete repairs', paymentType: 'Check', sipIncluded: 'no'
            };
            
            const [fields, setFields] = useState(initialFields);
            const [generatedNote, setGeneratedNote] = useState('');
            
            const mainSectionOrder = ['general', 'col', 'perimeter', 'roof', 'otherStructures', 'interior', 'subro', 'salvage', 'underwriting', 'settlement', 'finalNote'];

            // --- Handlers ---
            const handleFieldChange = (field, value) => {
                setFields(prev => ({ ...prev, [field]: value }));
            };

            const addParticipant = () => setParticipants(prev => [...prev, { id: Date.now(), name: '' }]);
            const updateParticipant = (id, name) => setParticipants(prev => prev.map(p => (p.id === id ? { ...p, name } : p)));
            const removeParticipant = id => setParticipants(prev => prev.filter(p => p.id !== id));

            const addRoom = () => handleFieldChange('rooms', [...fields.rooms, { id: Date.now(), name: '', description: '' }]);
            const updateRoom = (id, field, value) => handleFieldChange('rooms', fields.rooms.map(room => (room.id === id ? { ...room, [field]: value } : room)));
            const removeRoom = id => handleFieldChange('rooms', fields.rooms.filter(room => room.id !== id));
            
            const toggleCustomSection = (sectionId) => {
                const existing = customSections.find(s => s.insertAfterId === sectionId);
                if (existing) {
                    setCustomSections(prev => prev.filter(s => s.insertAfterId !== sectionId));
                } else {
                    const newSection = { id: Date.now(), content: '', insertAfterId: sectionId };
                    setCustomSections(prev => [...prev, newSection]);
                }
            };

            const updateCustomSection = (id, content) => {
                setCustomSections(prev => prev.map(sec => (sec.id === id ? { ...sec, content } : sec)));
            };
            
            // --- Helper Functions ---
            const formatParticipantList = (participantArray) => {
                const names = participantArray.map(p => p.name).filter(Boolean);
                if (names.length === 0) return 'no one';
                if (names.length === 1) return names[0];
                if (names.length === 2) return names.join(' and ');
                const allButLast = names.slice(0, -1).join(', ');
                const lastName = names[names.length - 1];
                return `${allButLast}, and ${lastName}`;
            };
            
            // --- Note Generation ---
            useEffect(() => {
                let note = `Inspected loss. I arrived on time and met with ${formatParticipantList(participants)}.`;
                
                const appendCustomSectionsFor = (sectionId) => {
                    customSections.filter(s => s.insertAfterId === sectionId).forEach(s => {
                        if(s.content) note += `\n\n${s.content}`;
                    });
                };
                
                 mainSectionOrder.forEach(sectionId => {
                    if (sectionId === 'general') {
                         appendCustomSectionsFor('general');
                    } else if (sectionId === 'perimeter' && fields.showPerimeter) {
                        note += `\n\nThe inspection revealed the following:`;
                    }
                    
                    switch (sectionId) {
                        case 'col': if (fields.showCol && fields.colDetails) note += `\n\nCOL: ${fields.colDetails}`; break;
                        case 'perimeter':
                             if (fields.showPerimeter) {
                                note += `\n\nPerimeter:\nAn inspection of the perimeter was performed to verify the presence of storm damage. ${fields.perimeterGeneral}`;
                                note += `\nFront: ${fields.perimeterFront}\nLeft: ${fields.perimeterLeft}\nRear: ${fields.perimeterRear}\nRight: ${fields.perimeterRight}\nEstimate: ${fields.perimeterEstimate}`;
                            } break;
                         case 'roof':
                            if (fields.showRoof) {
                                note += `\n\n${fields.adjusterName} Inspected the roof, which revealed the following:\n${fields.roofGeneral}`;
                                note += `\nFront Facing Slope(s): ${fields.roofFrontHits} hits per test square; ${fields.roofFrontWind} wind damaged shingles`;
                                note += `\nRight Facing Slope(s): ${fields.roofRightHits} hits per test square; ${fields.roofRightWind} wind damaged shingles`;
                                note += `\nRear Facing Slope(s): ${fields.roofRearHits} hits per test square; ${fields.roofRearWind} wind damaged shingles`;
                                note += `\nLeft Facing Slope(s): ${fields.roofLeftHits} hits per test square; ${fields.roofLeftWind} wind damaged shingles`;
                                note += `\nEstimate: ${fields.roofEstimate}`;
                            } break;
                        case 'otherStructures': if (fields.showOtherStructures && fields.otherStructuresDetails) note += `\n\nOther Structures:\n${fields.otherStructuresDetails}`; break;
                        case 'interior':
                            if (fields.rooms.length > 0) {
                                note += `\n\nInterior damages:`;
                                fields.rooms.forEach(room => { if (room.name && room.description) note += `\n\n${room.name}: ${room.description}`; });
                                note += `\nEstimate: ${fields.interiorEstimate}`;
                            } else { note += `\n\nInterior:\nAn inspection of the interior was not performed.`; }
                            break;
                        case 'subro': if (fields.showSubro) note += `\n\nSubro:\n${fields.subroDetails}`; break;
                        case 'salvage': if (fields.showSalvage) note += `\n\nSalvage:\n${fields.salvageDetails}`; break;
                        case 'underwriting': if (fields.showUnderwriting) note += `\n\nUnderwriting concerns:\n${fields.underwritingConcernsDetails}`; break;
                        case 'settlement':
                            note += `\n\nSettlement: ${fields.settlementDetails}`;
                            if (fields.settledOnSite === 'Yes') { note += `\nPayment type: ${fields.paymentType}\nSIP Included: ${fields.sipIncluded}`; }
                            break;
                    }
                    if(sectionId !== 'general') appendCustomSectionsFor(sectionId);
                });

                setGeneratedNote(note);
            }, [fields, participants, customSections]);
            
            const copyToClipboard = () => navigator.clipboard.writeText(generatedNote);

            // --- Render Logic ---
            const componentMap = {
                general: <Section title="General Inspection Details">
                    <label>Met with:</label>
                    {participants.map((p) => (
                        <div key={p.id} className="participant-row">
                            <input type="text" value={p.name} onChange={(e) => updateParticipant(p.id, e.target.value)} placeholder="Participant name..."/>
                            {participants.length > 1 && <button className="remove-btn" onClick={() => removeParticipant(p.id)}>X</button>}
                        </div>
                    ))}
                    <button onClick={addParticipant}>+ Add Participant</button>
                </Section>,
                col: <SectionToggle title="COL Section" show={fields.showCol} onToggle={() => handleFieldChange('showCol', !fields.showCol)}>
                    <textarea value={fields.colDetails} onChange={(e) => handleFieldChange('colDetails', e.target.value)} placeholder="Enter COL details..."></textarea>
                </SectionToggle>,
                 perimeter: <SectionToggle title="Perimeter Inspection" show={fields.showPerimeter} onToggle={() => handleFieldChange('showPerimeter', !fields.showPerimeter)}>
                    <label>General Observation:</label><input type="text" value={fields.perimeterGeneral} onChange={e => handleFieldChange('perimeterGeneral', e.target.value)} />
                    <label>Front:</label><input type="text" value={fields.perimeterFront} onChange={e => handleFieldChange('perimeterFront', e.target.value)} />
                    <label>Left:</label><input type="text" value={fields.perimeterLeft} onChange={e => handleFieldChange('perimeterLeft', e.target.value)} />
                    <label>Rear:</label><input type="text" value={fields.perimeterRear} onChange={e => handleFieldChange('perimeterRear', e.target.value)} />
                    <label>Right:</label><input type="text" value={fields.perimeterRight} onChange={e => handleFieldChange('perimeterRight', e.target.value)} />
                    <label>Estimate:</label><input type="text" value={fields.perimeterEstimate} onChange={e => handleFieldChange('perimeterEstimate', e.target.value)} />
                </SectionToggle>,
                roof: <SectionToggle title="Roof Inspection" show={fields.showRoof} onToggle={() => handleFieldChange('showRoof', !fields.showRoof)}>
                    <label>Adjuster Name:</label><select value={fields.adjusterName} onChange={e => handleFieldChange('adjusterName', e.target.value)}><option value="I">I</option><option value="Seeknow">Seeknow</option></select>
                    <label>General Observations:</label><textarea value={fields.roofGeneral} onChange={e => handleFieldChange('roofGeneral', e.target.value)} placeholder="e.g., No wind or hail damage..."></textarea>
                    <label>Front Slope Hits/Wind:</label><div style={{display:'flex', gap:'1rem'}}><input type="text" value={fields.roofFrontHits} onChange={e => handleFieldChange('roofFrontHits', e.target.value)} /><input type="text" value={fields.roofFrontWind} onChange={e => handleFieldChange('roofFrontWind', e.target.value)} /></div>
                    <label>Right Slope Hits/Wind:</label><div style={{display:'flex', gap:'1rem'}}><input type="text" value={fields.roofRightHits} onChange={e => handleFieldChange('roofRightHits', e.target.value)} /><input type="text" value={fields.roofRightWind} onChange={e => handleFieldChange('roofRightWind', e.target.value)} /></div>
                    <label>Rear Slope Hits/Wind:</label><div style={{display:'flex', gap:'1rem'}}><input type="text" value={fields.roofRearHits} onChange={e => handleFieldChange('roofRearHits', e.target.value)} /><input type="text" value={fields.roofRearWind} onChange={e => handleFieldChange('roofRearWind', e.target.value)} /></div>
                    <label>Left Slope Hits/Wind:</label><div style={{display:'flex', gap:'1rem'}}><input type="text" value={fields.roofLeftHits} onChange={e => handleFieldChange('roofLeftHits', e.target.value)} /><input type="text" value={fields.roofLeftWind} onChange={e => handleFieldChange('roofLeftWind', e.target.value)} /></div>
                    <label>Estimate:</label><input type="text" value={fields.roofEstimate} onChange={e => handleFieldChange('roofEstimate', e.target.value)} />
                </SectionToggle>,
                otherStructures: <SectionToggle title="Other Structures" show={fields.showOtherStructures} onToggle={() => handleFieldChange('showOtherStructures', !fields.showOtherStructures)}>
                     <textarea value={fields.otherStructuresDetails} onChange={e => handleFieldChange('otherStructuresDetails', e.target.value)} placeholder="Enter details..."></textarea>
                </SectionToggle>,
                interior: <Section title="Interior Damages">
                    {fields.rooms.map((room, index) => (
                        <div key={room.id}><label>Room {index + 1}:</label><div className="participant-row"><input type="text" value={room.name} onChange={e => updateRoom(room.id, 'name', e.target.value)} placeholder="e.g., Kitchen" /><button className="remove-btn" onClick={() => removeRoom(room.id)}>X</button></div><label>Description:</label><textarea value={room.description} onChange={e => updateRoom(room.id, 'description', e.target.value)} placeholder="e.g., Water stain..."></textarea></div>
                    ))}<button onClick={addRoom}>+ Add Room</button>
                    {fields.rooms.length > 0 && <div style={{marginTop:'1.5rem'}}><label>Overall Estimate:</label><textarea value={fields.interiorEstimate} onChange={e => handleFieldChange('interiorEstimate', e.target.value)}></textarea></div>}
                </Section>,
                subro: <SectionToggle title="Subrogation" show={fields.showSubro} onToggle={() => handleFieldChange('showSubro', !fields.showSubro)}><textarea value={fields.subroDetails} onChange={e => handleFieldChange('subroDetails', e.target.value)}></textarea></SectionToggle>,
                salvage: <SectionToggle title="Salvage" show={fields.showSalvage} onToggle={() => handleFieldChange('showSalvage', !fields.showSalvage)}><textarea value={fields.salvageDetails} onChange={e => handleFieldChange('salvageDetails', e.target.value)}></textarea></SectionToggle>,
                underwriting: <SectionToggle title="Underwriting Concerns" show={fields.showUnderwriting} onToggle={() => handleFieldChange('showUnderwriting', !fields.showUnderwriting)}><textarea value={fields.underwritingConcernsDetails} onChange={e => handleFieldChange('underwritingConcernsDetails', e.target.value)}></textarea></SectionToggle>,
                settlement: <Section title="Settlement">
                    <label>Settlement Details:</label><textarea value={fields.settlementDetails} onChange={e => handleFieldChange('settlementDetails', e.target.value)}></textarea>
                    <label>Settled on Site?</label><select value={fields.settledOnSite} onChange={e => handleFieldChange('settledOnSite', e.target.value)}><option value="No">No</option><option value="Yes">Yes</option></select>
                    {fields.settledOnSite === 'Yes' && (<><label>Payment type:</label><select value={fields.paymentType} onChange={e => handleFieldChange('paymentType', e.target.value)}><option value="Check">Check</option><option value="Manual Check">Manual Check</option><option value="EFT">EFT</option></select><label>SIP Included:</label><select value={fields.sipIncluded} onChange={e => handleFieldChange('sipIncluded', e.target.value)}><option value="yes">Yes</option><option value="no">No</option></select></>)}
                </Section>,
                finalNote: <Section title="Generated Inspection Note">
                    <pre>{generatedNote}</pre>
                    <button className="copy-btn" onClick={copyToClipboard}>Copy Note</button>
                </Section>,
            };
            
            return (
                <div>
                    <h1>Inspection Note Builder</h1>
                    {mainSectionOrder.map(sectionId => {
                        const customSection = customSections.find(s => s.insertAfterId === sectionId);
                        const hasCustomSection = !!customSection;

                        return (
                            <React.Fragment key={sectionId}>
                                <div className="section-wrapper">
                                    <div className="section-card">{componentMap[sectionId]}</div>
                                    {sectionId !== 'finalNote' && (
                                        <button 
                                            className={`add-between-btn ${hasCustomSection ? 'minus' : ''}`} 
                                            onClick={() => toggleCustomSection(sectionId)}
                                        >
                                            {hasCustomSection ? '−' : '+'}
                                        </button>
                                    )}
                                </div>
                                {hasCustomSection && (
                                    <div className="custom-section-card">
                                        <h4>Custom Note</h4>
                                        <textarea value={customSection.content} onChange={e => updateCustomSection(customSection.id, e.target.value)} placeholder="Enter custom notes here..."/>
                                    </div>
                                )}
                            </React.Fragment>
                        );
                    })}
                </div>
            );
        }
        
        const Section = ({ title, children }) => (
            <>
                <h2>{title}</h2>
                <div style={{paddingTop: '1rem'}}>{children}</div>
            </>
        );

        const SectionToggle = ({ title, show, onToggle, children }) => (
            <>
                <h2 onClick={onToggle} style={{ cursor: 'pointer' }}>
                    {title} 
                    <span style={{marginLeft: 'auto', fontSize:'1.5rem', fontWeight: 400, color: 'var(--primary-color)'}}>{show ? '−' : '+'}</span>
                </h2>
                {show && <div style={{paddingTop: '1rem', animation: 'fadeIn 0.5s ease'}}>{children}</div>}
            </>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>